# Tables 

## Data

### Fishery-dependent data
 
```{r} 
#| label: 'set-rda-dir-tbls'
#| echo: false 
#| warning: false 
#| eval: true 
#| include: false
library(flextable)

# You can save tables to read in as csv or rda files.
# stockplotr generally uses rda files.
# I (Kiva) prefer csv files because they are text files that are easier to track and preview with version control.

# There are many ways to incorporate tables into quarto documents.
# One is using the flextable package via R chunks.
# For help: https://ardata-fr.github.io/flextable-book/

``` 

```{r}
#| label: tbl-all_removals
#| echo: false
#| warning: false
#| tbl-cap: "Landings for bottom trawl, midwater trawl, net, and hook-and-line (mt) fisheries from Washington, Oregon, and California."

#table 1

# CatchTable <- read.csv("Tables/CatchTable.csv")%>%
# select(-ComModelTotal)
# CatchTable[is.na(CatchTable)] <- 0
# CatchTable |>
#   gt() |>
#  cols_label(
#     year = "Year",
#     ComWA = "Com. WA",
#     ComOR = "Com. OR",
#     ComCA = "Com. CA",
#     ComDiscards = "Com. Discards",
#     Foreign = "For.",
#     RecWA = "Rec. WA",
#     RecOR = "Rec. OR",
#     RecCA = "Rec. CA",
#   ) |> 
#   tab_options(
#     table.font.size = 12,
#     latex.use_longtable = TRUE
#   ) |>
#   as_latex()

```

{{< pagebreak >}}

```{r}
#| label: tbl-hake_removals
#| echo: false
#| warning: false
#| tbl-cap: "Landings (mt) from the foreign & domestic at-sea fleet and the domestic shoreside hake fleet.Catches (mt) from the Pacific whiting at-sea fishery as determined by onboard observers."

#table 2
library(flextable)
library(dplyr)
library(tidyr)

HakeTable <- read.csv(file.path(here::here(),"report/tables/Table_2_2025.csv"))
colnames(HakeTable) <- gsub("\\.", " ", colnames(HakeTable))



# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(HakeTable),
  line1 = c("Year", "Foreign & Domestic", rep("Shoreside hake", 3)),
  line2 = c("", "At-sea", "CA", "OR", "WA"),
  stringsAsFactors = FALSE
)

# Create flextable
flextable(HakeTable, col_keys = names(HakeTable)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  colformat_num(j = 1, big.mark = "", digits = 0) %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit()


```

{{< pagebreak >}}

```{r}
#| label: tbl-manage-act
#| echo: false
#| warning: false
#| tbl-cap: "A subset of management actions of importance to fisheries that caught Widow Rockfish. "

#table 3

library(flextable)
library(dplyr)
library(tidyr)
ManageTable<- read.csv(file.path(here::here(),"report/tables/Table_3_2025.csv"))
colnames(ManageTable) <- c("Year","Management action")

ManageTable<- ManageTable %>%
  group_by(Year)%>%
  ungroup()
  # mutate(Year_Display = ifelse(row_number() == 1, as.character(Year), "")) %>%
  

flextable(ManageTable) %>%
  set_header_labels(Year = "Year", `Management action` = "Management action") %>%
  merge_v(j = "Year") %>%
  align(j = "Year", align = "center", part = "all") %>%
  align(j = "Management action", align = "left", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  border_outer(part = "all") %>%
  border_inner(part = "all") %>%
  colformat_num(j = 1, big.mark = "", digits = 0) %>%
  flextable::width(j = "Year", width = 0.7) %>%  # Year column width
  flextable::width(j = "Management action", width = 5)   # Management action column width


# select(-ComModelTotal)
# CatchTable[is.na(CatchTable)] <- 0
# CatchTable |>
#   gt() |>
#  cols_label(
#     year = "Year",
#     ComWA = "Com. WA",
#     ComOR = "Com. OR",
#     ComCA = "Com. CA",
#     ComDiscards = "Com. Discards",
#     Foreign = "For.",
#     RecWA = "Rec. WA",
#     RecOR = "Rec. OR",
#     RecCA = "Rec. CA",
#   ) |> 
#   tab_options(
#     table.font.size = 12,
#     latex.use_longtable = TRUE
#   ) |>
#   as_latex()

```

```{r}
#| label: tbl-manage-guide
#| echo: false
#| warning: false
#| tbl-cap: "Management guidelines for Widow Rockfish from 2004 to 2024. Total landings (mt) are also shown."

#Table 4

library(flextable)
library(dplyr)
library(tidyr)

#table4_data <- as.data.frame(read.csv(file.path(here::here(),"report/tables/exec_summ_tables/f_Manage_ES.csv"), stringsAsFactors = FALSE))

table4_data <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table4.csv"), stringsAsFactors = FALSE))
colnames(table4_data) <- gsub("\\.", " ", colnames(table4_data))

flextable(table4_data) %>%
  # Set header labels
  set_header_labels(
    Year = "Year",
    `OFL (mt) (termed ABC prior to 2011)` = "OFL (mt)\n(termed ABC\nprior to 2011)",
    `ABC (mt)` = "ABC (mt)",
    `ACL (mt) (termed OY prior to 2011)` = "ACL (mt)\n(termed OY\nprior to 2011)",
    `Commercial Landings (mt)` = "Commercial\nLandings (mt)",
    `Estimated Total Catch (mt)` = "Estimated Total\nCatch (mt)"
  ) %>%
  # Apply borders
  border(part = "all", border = officer::fp_border(color = "black", width = 1)) %>%
  # Align header and body
  align(align = "center", part = "header") %>%
  align(align = "right", part = "body", j = -1) %>%
  # Bold header
  bold(part = "header") %>%
  # Set font
  font(fontname = "Times New Roman", part = "all") %>%
colformat_num(j = 1, big.mark = "", digits = 0)








```

:::
{{< pagebreak >}}

```{r}
#| label: tbl-depth-surv
#| echo: false
#| warning: false
#| tbl-cap: "Depth ranges and limits of the southern latitude in the Triennial survey for the different years."

#Old table 6

library(flextable)
library(dplyr)
library(tidyr)

table6_data <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table6.csv"), stringsAsFactors = FALSE))


# Function for consistent table styling
style_flextable <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

# Create Flextable for Table 6
table6_data %>%
  flextable() %>%
  set_header_labels(
    Years = "Years",
    Depth_range_m = "Depth range (m)",
    Southern_latitude = "Southern latitude"
  ) %>%
  style_flextable()





```


```{r}
#| label: tbl-strat-surv
#| echo: false
#| warning: false
#| tbl-cap: "Stratifications used for the two surveys."

library(flextable)
library(dplyr)
library(tidyr)

table7_nwfsc_data <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table7_nwfsc.csv"), stringsAsFactors = FALSE))

table7_triennial_data <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table7_triennial.csv"), stringsAsFactors = FALSE))

# Function for consistent table styling
style_flextable <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

# Create Flextable for Table 7 (Triennial)
table7_triennial_data %>%
  flextable() %>%
  set_header_labels(
    Strata = "Strata",
    Area_km2 = "Area (km2)",
    Depth1 = "Depth1",
    Depth2 = "Depth2",
    Latitude1 = "Latitude1",
    Latitude2 = "Latitude2"
  ) %>%
  add_header_row(values = c("Triennial"), colwidths = 6) %>%
  style_flextable()

# Create Flextable for Table 7 (NWFSC WCGBT)
table7_nwfsc_data %>%
  flextable() %>%
  set_header_labels(
    Strata = "Strata",
    Area_km2 = "Area (km2)",
    Depth1 = "Depth1",
    Depth2 = "Depth2",
    Latitude1 = "Latitude1",
    Latitude2 = "Latitude2"
  ) %>%
  add_header_row(values = c("NWFSC WCGBT"), colwidths = 6) %>%
  style_flextable()



```

{{< pagebreak >}}

```{r}
#| label: tbl-numposi-tows
#| echo: false
#| warning: false
#| tbl-cap: "Number of positive tows, lengths, and ages in each year from the Triennial survey (Tri) and the NWFSC WCGBT survey (NW)."

#Old table 9
table9 <- as.data.frame(read.csv(file.path(here::here(),"figures/WCGBTS_survey/survey_pos_catch.csv"), stringsAsFactors = FALSE))


# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(table9),
  line1 = c("Year", rep("Number of positive tows", 2), rep("Number of tows with lengths", 2), rep("Number of lengths", 2),rep("Number of tows with ages", 2),rep("Number of ages", 2)),
  line2 = c("","Tri","NW", "Tri","NW", "Tri","NW", "Tri","NW", "Tri","NW"),
  stringsAsFactors = FALSE
)


# Create flextable
flextable(table9, col_keys = names(table9)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit() %>%
  colformat_num(j = 1, big.mark = "", digits = 0)






```

{{< pagebreak >}}
\blandscape
```{r}
#| label: tbl-num-land-length
#| echo: false
#| warning: false
#| tbl-cap: "Number of landings sampled for length data by gear and state for non-whiting fisheries."

#Old table 10



table10 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_10.csv"), stringsAsFactors = FALSE))
#Remove periods
colnames(table9) <- gsub("\\.", " ", colnames(table9))


# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(table10),
  line1 = c("","Year", rep("Bottom Trawl", 3), rep("Midwater Trawl", 3),rep("Net", 2),rep("Hook-and-Line", 3)),
  line2 = c(" "," ", "CA", "OR", "WA", "CA", "OR", "WA", "CA", "WA", "CA", "OR", "WA"),
  stringsAsFactors = FALSE
)

# Create flextable
flextable(table10, col_keys = names(table10)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit() %>%
  colformat_num(j = 2, big.mark = "", digits = 0)





```

```{r}
#| label: tbl-len-gear-state
#| echo: false
#| warning: false
#| tbl-cap: "Number of lengths of Widow Rockfish by gear and state for non-whiting fisheries."

#Old table 11
table11 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_11.csv"), stringsAsFactors = FALSE))



# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(table10),
  line1 = c("","Year", rep("Bottom Trawl", 3), rep("Midwater Trawl", 3),rep("Net", 2),rep("Hook-and-Line", 3)),
  line2 = c(" "," ", "CA", "OR", "WA", "CA", "OR", "WA", "CA", "WA", "CA", "OR", "WA"),
  stringsAsFactors = FALSE
)

# Create flextable
flextable(table11, col_keys = names(table11)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit() %>%
  colformat_num(j = 2, big.mark = "", digits = 0)



```
\elandscape
```{r}
#| label: tbl-landings-hake
#| echo: false
#| warning: false
#| tbl-cap: "Number of landings and number of lengths sampled from the at-sea hake and shoreside hake fisheries."

#Old table 12
table12 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_12.csv"), stringsAsFactors = FALSE))



# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(table12),
  line1 = c("","Year", rep("Number of hauls (at-sea) or landings (shoreside)", 2), rep("Number of lengths", 2)),
  line2 = c(" "," ","Domestic at-sea", "Shoreside","Domestic at-sea", "Shoreside" ),
  stringsAsFactors = FALSE
)

# Create flextable
flextable(table12, col_keys = names(table12)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit() %>%
  colformat_num(j = 2, big.mark = "", digits = 0)



```

```{r}
#| label: tbl-sample-age-gear-state
#| echo: false
#| warning: false
#| tbl-cap: "Number of landings sampled for ages by gear and state for non-whiting fisheries."

#Old table 13
table13 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_13.csv"), stringsAsFactors = FALSE))



# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(table13),
  line1 = c("","Year", rep("Bottom Trawl", 3), rep("Midwater Trawl", 3),rep("Net", 2),rep("Hook-and-Line", 3)),
  line2 = c(" "," ", "CA", "OR", "WA", "CA", "OR", "WA", "CA", "WA", "CA", "OR", "WA"),
  stringsAsFactors = FALSE
)

# Create flextable
flextable(table13, col_keys = names(table13)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit() %>%
  colformat_num(j = 2, big.mark = "", digits = 0)



```

```{r}
#| label: tbl-age-gear-state
#| echo: false
#| warning: false
#| tbl-cap: "Number of landings sampled for ages by gear and state for non-whiting fisheries."

#Old table 13
table14 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_14.csv"), stringsAsFactors = FALSE))



# Build header map (multi-row header)
header_df <- data.frame(
  keys = names(table14),
  line1 = c("","Year", rep("Bottom Trawl", 3), rep("Midwater Trawl", 3),rep("Net", 2),rep("Hook-and-Line", 3)),
  line2 = c(" "," ", "CA", "OR", "WA", "CA", "OR", "WA", "CA", "WA", "CA", "OR", "WA"),
  stringsAsFactors = FALSE
)

# Create flextable
flextable(table14, col_keys = names(table14)) %>%
  set_header_df(mapping = header_df, key = "keys") %>%
  merge_h(part = "header") %>%
  merge_v(part = "header") %>%
  border(part = "all") %>%
  align(align = "center", part = "all") %>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  autofit() %>%
  colformat_num(j = 2, big.mark = "", digits = 0)



```

```{r}
#| label: tbl-disc totals
#| echo: false
#| warning: false
#| tbl-cap: "Discard totals (mt) for four fleets derived from Pikitch data, EDCP data, and WCGOP data. Italics indicate years that were not fitted to because they were simply added to the landings (Shoreside hake) or omitted because they were outside of the main study period."

#Old table 16




table16 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_16_data.csv"), stringsAsFactors = FALSE))
#Remove periods
colnames(table16) <- gsub("\\.", " ", colnames(table16))

# Function for consistent table styling
style_table16 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")%>%
    colformat_num(j = 2, big.mark = "", digits = 0)%>%
    autofit()
}
# Create Flextable for Table 20
table16 %>%
  flextable() %>%
  style_table16()





```

```{r}
#| label: tbl-age-error
#| echo: false
#| warning: false
#| tbl-cap: "Ageing error for two labs that was used in the assessment model."

#Old table 20

library(flextable)
library(dplyr)
library(tidyr)
library(officer)

table20<- as.data.frame(read.csv(file.path(here::here(),"report/tables/table20.csv"), stringsAsFactors = FALSE))


# Function for consistent table styling
style_table20 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}
# Create Flextable for Table 20
table20 %>%
  flextable() %>%
  set_header_labels(
    True.Age = "True Age",
    Standard.Deviation.CAP = "Standard Deviation CAP",
    Standard.Deviation.SWFSC = "Standard Deviation SWFSC"
  ) %>%
  style_table20()
  





```

```{r}
#| label: tbl-speci-base-assess
#| echo: false
#| warning: false
#| tbl-cap: "Specifications of the base assessment model for Widow Rockfish."

#Old table 21

library(flextable)
library(dplyr)
library(tidyr)
library(officer)

table21<- as.data.frame(openxlsx::read.xlsx(file.path(here::here(),"report/tables/table_21.xlsx")))
colnames(table21) <- c("1","2 ","3  ")


my_border <- fp_border(color = "black", width = 2)


# Function for consistent table styling
flextable(table21) %>%
  delete_part(part="header")%>%
  border(part = "all") %>%
  align(align = "left", j=2) %>%
  italic(i = c(2, 7,14,26), italic = TRUE)%>%
  font(fontname = "Times New Roman", part = "all") %>%
  bold(part = "header")%>%
  border(border.top = my_border, i = 1) %>%
  autofit() %>%
  colformat_num(j = 1, big.mark = "", digits = 0)%>%
  fontsize(size = 9, part = "all")%>%
  set_table_properties(layout = "autofit")

```


```{r}
#| label: tbl-bio-params
#| echo: false
#| warning: false
#| tbl-cap: "Description of biological parameters in the base case assessment model. The lognormal (LN) prior distribution is specified with the median of the parameter and the standard deviation of the log of the parameter."

#Old table 22

# Function for consistent table styling
table22 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_22.csv"))) 
table22 <- table22[,2:ncol(table22)] 
my_border <- fp_border(color = "black", width = 2) 
# Build header map (multi-row header) 
header_df <- data.frame( keys = names(table22), 
                         line1 = c("", "Initial", "Number", "Bounds","Prior"), 
                         line2 = c("Parameter", "value", "estimated", "(low, high)", "distribution"), stringsAsFactors = FALSE ) 
# Function for consistent table styling 
flextable(table22) %>% 
  set_header_df(mapping = header_df, key = "keys") %>% 
  border(part = "all") %>% align(align = "left", j=2) %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  bold(part = "header")%>% border(border.top = my_border, i = 1) %>% 
  autofit() %>% 
  colformat_num(j = 1, big.mark = "", digits = 0)%>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")

```

```{r}
#| label: tbl-param-ests-basecase
#| echo: false
#| warning: false
#| tbl-cap: "Description of biological parameters in the base case assessment model. The lognormal (LN) prior distribution is specified with the median of the parameter and the standard deviation of the log of the parameter."

#Old table 23

# Function for consistent table styling
table23 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_23.csv"))) 
colnames(table23) <- c(" ","Parameter", "Estimate", "SD")
table23
my_border <- fp_border(color = "black", width = 2) 
# Build header map (multi-row header) 
header_df <- data.frame( keys = names(table22), 
                         line1 = c("", "Initial", "Number", "Bounds","Prior"), 
                         line2 = c("Parameter", "value", "estimated", "(low, high)", "distribution"), stringsAsFactors = FALSE ) 
# Function for consistent table styling 
flextable(table23) %>% 
  #set_header_df(mapping = header_df, key = "keys") %>% 
  border(part = "all") %>% align(align = "left", j=2) %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  italic(i=c(3,17,25), italic=TRUE)%>%
  bold(part = "header")%>% border(border.top = my_border, i = 1) %>% 
  autofit() %>% 
  colformat_num(j = 1, big.mark = "", digits = 0)%>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")

```


```{r}
#| label: tbl-param-ests-select
#| echo: false
#| warning: false
#| tbl-cap: "Parameter estimates and approximate asymptotic standard deviations for the base case model selectivity parameters. "

#Old table 24

# Function for consistent table styling
table24 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_24.csv"))) 
colnames(table24) <- gsub("\\.", " ", colnames(table24))


my_border <- fp_border(color = "black", width = 2) 

# Function for consistent table styling 
flextable(table24) %>% 
  border(part = "all") %>% align(align = "left", j=2) %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  bold(part = "header")%>% border(border.top = my_border, i = 1) %>% 
  autofit() %>% 
  colformat_num(j = ncol(table24), big.mark = "", digits = 0)%>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")

```

```{r}
#| label: tbl-likecomps
#| echo: false
#| warning: false
#| tbl-cap: "Likelihood components and other quantities related to the minimization of the base case model."

#Old table 25

# Function for consistent table styling
table25 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_25.csv"))) 


my_border <- fp_border(color = "black", width = 2) 

# Function for consistent table styling 
flextable(table25) %>% 
  border(part = "all") %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  bold(part = "header")%>% 
  italic(i=3,italic=TRUE)%>%
  border(border.top = my_border, i = 1) %>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")

```

```{r}
#| label: tbl-key-deriv-params
#| echo: false
#| warning: false
#| tbl-cap: "Estimates of key derived parameters and reference points with approximate 95% asymptotic confidence intervals."

#Old table 26

# Function for consistent table styling
table26 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/exec_summ_tables/e_ReferencePoints_ES.csv"))) 

my_border <- fp_border(color = "black", width = 2)

colnames(table26) <- gsub("\\.", " ", colnames(table26))

table26 <- table26 %>%
  mutate(
    `~95% Confidence Interval` = paste0(`Lower Interval`, " - ", `Upper Interval`)
  ) %>%
  # Remove the original "Lower Interval" and "Upper Interval" columns
  select(-`Lower Interval`, -`Upper Interval`)

table26[6,3] <- " "
table26[11,3] <- " "
table26[16,3] <- " "

# Function for consistent table styling 
flextable(table26) %>% 
  border(part = "all") %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  bold(part = "header")%>% 
  align(align = "center", j = c(2,3))%>% 
  italic(i=c(6,11,13,16),italic=TRUE)%>%
  bold(i=c(6,11,16),bold=TRUE)%>%
  border(border.top = my_border, i = 1) %>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")

```

```{r}
#| label: tbl-ts-popests-basecase
#| echo: false
#| warning: false
#| tbl-cap: "Time series of population estimates from the base case model."

#Old table 27

# Function for consistent table styling
table27 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_27.csv")))  

my_border <- fp_border(color = "black", width = 2)

# Build header map (multi-row header) 
header_df <- data.frame( keys = names(table27), 
                         line1 = c("Year", "Total", "Spawning", "Age 4+ ", "Spawning", "Age-0", "Estimated Total", "1 - SPR", "Relative Exploitation"), 
                         line2 = c("  ", "Biomass (mt)", "Biomass (mt)","Biomass (mt)", " Depletion(mt)", "recruits", "Catch (mt)","(%)","rate (%)"), stringsAsFactors = FALSE ) 


# Function for consistent table styling 
flextable(table27) %>% 
  set_header_df(mapping = header_df, key = "keys") %>% 
  border(part = "all") %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  bold(part = "header")%>% 
  align(align = "center", part="body")%>% 
  align(align = "center", part="header")%>% 
  border(border.top = my_border, i = 1) %>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")%>%
  colformat_num(j = 1, big.mark = "", digits = 0)


```

```{r}
#| label: tbl-lognorm-recdevs
#| echo: false
#| warning: false
#| tbl-cap: "Time series of log-normal recruitment deviation estimates from the base case model."

#Old table 28

# Function for consistent table styling
table28 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/table_28.csv")))  

my_border <- fp_border(color = "black", width = 2)

colnames(table28) <- gsub("\\.", " ", colnames(table26))

# Function for consistent table styling 
flextable(table28) %>% 
  border(part = "all") %>% 
  font(fontname = "Times New Roman", part = "all") %>% 
  bold(part = "header")%>% 
  align(align = "center", j = c(2,3))%>% 
  colformat_num(j = 1, big.mark = "", digits = 0)%>%
  border(border.top = my_border, i = 1) %>% 
  fontsize(size = 9, part = "all")%>% 
  set_table_properties(layout = "autofit")

```

::: {.pagebreak page-layout="landscape"}

```{r}
#| label: tbl-quant-sens-int
#| echo: false
#| warning: false
#| tbl-cap: "Quantities of interest from the sensitivity analyses. ‘RSB2018’ refers to depletion in 2018 (SB$_{2015}$/SB$_0$)"

#Old table 29
#needs to be landscape! 

library(flextable)
library(dplyr)
library(tidyr)
library(officer)

table29 <- as.data.frame(read.csv(file.path(here::here(),"report/tables/sens_table.csv"), stringsAsFactors = FALSE))
#Remove periods
colnames(table29) <- gsub("\\.", " ", colnames(table29))

# Function for consistent table styling
style_table29 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

likelihood_row <- which(apply(table29, 1, function(row) any(row == "Likelihood")))


# Add a row that spans all columns (like a section header)
  flextable(table29) %>%
  compose(i = likelihood_row, j = 1, value = as_paragraph("Difference from Base Model Likelihood")) %>%
  merge_at(i = likelihood_row, j = 1:ncol(table29), part = "body") %>%
  align(i = likelihood_row, j = 1:ncol(table29), align = "center", part = "body") %>%
  bold(i = likelihood_row, part = "body") %>%
  border(i = 1, j = 1:ncol(table29), part = "footer", border = fp_border(color = "transparent", width = 0)) %>%
  # Keep the outer bottom border of the merged footer row
  border(i = 1, j = 1:ncol(table29), part = "footer", border = fp_border(color = "black", width = 1))%>%
  style_table29()%>%
  autofit()




```

::: 

{{< pagebreak >}}
```{r}
#| label: tbl-retros
#| echo: false
#| warning: false
#| tbl-cap: "Results from retrospective runs, sequentially removing data over the last five years using the base case assumptions."

#Old table 30

library(flextable)
library(dplyr)
library(tidyr)
library(officer)

table30<- read.csv(file.path(here::here(),"report/tables/retro_quant_table.csv"), stringsAsFactors = FALSE)
#Remove periods
colnames(table30) <- gsub("\\.", " ", colnames(table30))

# Function for consistent table styling
style_table30 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

likelihood_row <- which(apply(table30, 1, function(row) any(row == "Likelihood")))


# Add a row that spans all columns (like a section header)
  flextable(table30) %>%
  compose(i = likelihood_row, j = 1, value = as_paragraph("Difference from Base Model Likelihood")) %>%
  merge_at(i = likelihood_row, j = 1:ncol(table30), part = "body") %>%
  align(i = likelihood_row, j = 1:ncol(table30), align = "center", part = "body") %>%
  bold(i = likelihood_row, part = "body") %>%
  border(i = 1, j = 1:ncol(table30), part = "footer", border = fp_border(color = "transparent", width = 0)) %>%
  # Keep the outer bottom border of the merged footer row
  border(i = 1, j = 1:ncol(table30), part = "footer", border = fp_border(color = "black", width = 1))%>%
  style_table30()%>%
  autofit()


```

::: {.pagebreak page-layout="landscape"}

```{r}
#| label: tbl-like-R0
#| echo: false
#| warning: false
#| tbl-cap: "Results from retrospective runs, sequentially removing data over the last five years using the base case assumptions."

#Old table 31

table31 <- read.csv(file.path(here::here(),"report/tables/SR_LN(R0)_quant_table.csv"), stringsAsFactors = FALSE)
#Remove periods
colnames(table31) <- c("log(R0)",	"R0 10.4","R0 10.2","R0 10","R0 9.8","R0 10.6","R0 10.8","R0 11","R0 11.2","R0 11.4")

# Function for consistent table styling
style_table31 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

likelihood_row <- which(apply(table31, 1, function(row) any(row == "Likelihood")))


# Add a row that spans all columns (like a section header)
  flextable(table31) %>%
  compose(i = likelihood_row, j = 1, value = as_paragraph("Difference from Base Model Likelihood")) %>%
  merge_at(i = likelihood_row, j = 1:ncol(table31), part = "body") %>%
  align(i = likelihood_row, j = 1:ncol(table31), align = "center", part = "body") %>%
  bold(i = likelihood_row, part = "body") %>%
  border(i = 1, j = 1:ncol(table31), part = "footer", border = fp_border(color = "transparent", width = 0)) %>%
  # Keep the outer bottom border of the merged footer row
  border(i = 1, j = 1:ncol(table31), part = "footer", border = fp_border(color = "black", width = 1))%>%
  style_table31()%>%
  autofit()


```
:::

::: {.pagebreak page-layout="landscape"}

```{r}
#| label: tbl-like-steep
#| echo: false
#| warning: false
#| tbl-cap: "Quantities of interest when profiling over steepness values."

#Old table 31

table32 <- read.csv(file.path(here::here(),"report/tables/SR_BH_steep_quant_table.csv"), stringsAsFactors = FALSE)
#Remove periods
colnames(table32) <- c("steepness (h)","0.715","0.66","0.605","0.55","0.495","0.44","0.385","0.33","0.275","0.77","0.825",	"0.88")

# Function for consistent table styling
style_table32 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

likelihood_row <- which(apply(table32, 1, function(row) any(row == "Likelihood")))


# Add a row that spans all columns (like a section header)
  flextable(table32) %>%
  compose(i = likelihood_row, j = 1, value = as_paragraph("Difference from Base Model Likelihood")) %>%
  merge_at(i = likelihood_row, j = 1:ncol(table32), part = "body") %>%
  align(i = likelihood_row, j = 1:ncol(table32), align = "center", part = "body") %>%
  bold(i = likelihood_row, part = "body") %>%
  border(i = 1, j = 1:ncol(table32), part = "footer", border = fp_border(color = "transparent", width = 0)) %>%
  # Keep the outer bottom border of the merged footer row
  border(i = 1, j = 1:ncol(table32), part = "footer", border = fp_border(color = "black", width = 1))%>%
  style_table32()%>%
  autofit()


```
:::

::: {.pagebreak page-layout="landscape"}

```{r}
#| label: tbl-like-Mfemale
#| echo: false
#| warning: false
#| tbl-cap: "Quantities of interest when profiling over natural mortality values for females"

#Old table 33

table33 <- read.csv(file.path(here::here(),"report/tables/NatM_uniform_Fem_GP_1_quant_table.csv"), stringsAsFactors = FALSE)
#Remove periods
colnames(table33) <- c("Natural Mortality (females)","0.121",	"0.11",	"0.099",	"0.088",	"0.132","0.143","0.154",	"0.165",	"0.176",	"0.187",	"0.198")

# Function for consistent table styling
style_table33 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

likelihood_row <- which(apply(table33, 1, function(row) any(row == "Likelihood")))


# Add a row that spans all columns (like a section header)
  flextable(table33) %>%
  compose(i = likelihood_row, j = 1, value = as_paragraph("Difference from Base Model Likelihood")) %>%
  merge_at(i = likelihood_row, j = 1:ncol(table33), part = "body") %>%
  align(i = likelihood_row, j = 1:ncol(table33), align = "center", part = "body") %>%
  bold(i = likelihood_row, part = "body") %>%
  border(i = 1, j = 1:ncol(table33), part = "footer", border = fp_border(color = "transparent", width = 0)) %>%
  # Keep the outer bottom border of the merged footer row
  border(i = 1, j = 1:ncol(table33), part = "footer", border = fp_border(color = "black", width = 1))%>%
  style_table33()%>%
  autofit()


```
:::

::: {.pagebreak page-layout="landscape"}

```{r}
#| label: tbl-like-Mmale
#| echo: false
#| warning: false
#| tbl-cap: "Quantities of interest when profiling over natural mortality values for males"

#Old table 33

table34 <- read.csv(file.path(here::here(),"report/tables/NatM_uniform_Mal_GP_1_quant_table.csv"), stringsAsFactors = FALSE)
#Remove periods
colnames(table34) <- c("Natural Mortality (males)","0.132",	"0.121",	"0.11",	"0.099",	"0.088",	"0.143",	"0.154",	"0.165",	"0.176",	"0.187",	"0.198")

# Function for consistent table styling
style_table34 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}

likelihood_row <- which(apply(table33, 1, function(row) any(row == "Likelihood")))


# Add a row that spans all columns (like a section header)
  flextable(table34) %>%
  compose(i = likelihood_row, j = 1, value = as_paragraph("Difference from Base Model Likelihood")) %>%
  merge_at(i = likelihood_row, j = 1:ncol(table34), part = "body") %>%
  align(i = likelihood_row, j = 1:ncol(table34), align = "center", part = "body") %>%
  bold(i = likelihood_row, part = "body") %>%
  border(i = 1, j = 1:ncol(table34), part = "footer", border = fp_border(color = "transparent", width = 0)) %>%
  # Keep the outer bottom border of the merged footer row
  border(i = 1, j = 1:ncol(table34), part = "footer", border = fp_border(color = "black", width = 1))%>%
  style_table34()%>%
  autofit()


```
:::

{{< pagebreak >}}

```{r}
#| label: tbl-weightingcomps
#| echo: false
#| warning: false
#| tbl-cap: "Estimated Dirichlet-multinomial parameters and the corresponding data weights derived using the McAllister-Ianelli and Francis methods. The Dirichlet-multinomial ln(EffN_mult) parameter was bounded between -7 and 7."

#Old table 34

table34 <- read.csv(file.path(here::here(),"figures/sensitivities/weighting_comps.csv"), stringsAsFactors = FALSE)
#Remove periods
colnames(table34) <- gsub("\\.", " ", colnames(table34))


# Function for consistent table styling
style_table34 <- function(ft) {
  ft %>%
    font(fontname = "Times New Roman", part = "all") %>%
    border_outer(part = "all") %>%
    border_inner(part = "all") %>%
    align(align = "center", part = "header") %>%
    align(align = "center", part = "body")
}


# Add a row that spans all columns (like a section header)
  flextable(table34) %>%
  style_table34()%>%
  autofit()


```
